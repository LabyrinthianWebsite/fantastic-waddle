<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title><%= character ? 'Edit' : 'Add' %> Upper Campus Character - Admin - CommissionDB</title>
    <link rel="stylesheet" href="/public/css/style.css">
    <link rel="stylesheet" href="/public/css/admin.css">
</head>
<body class="dark-theme">
    <nav class="admin-navbar">
        <div class="admin-navbar-container">
            <div class="admin-navbar-brand">
                <a href="/admin">CommissionDB Admin</a>
            </div>
            
            <div class="admin-navbar-menu">
                <a href="/admin" class="admin-navbar-item">Dashboard</a>
                <a href="/admin/commissions" class="admin-navbar-item">Commissions</a>
                <a href="/admin/characters" class="admin-navbar-item">Characters</a>
                <a href="/admin/upper-campus" class="admin-navbar-item active">Upper Campus</a>
                <a href="/admin/artists" class="admin-navbar-item">Artists</a>
                <a href="/admin/tags" class="admin-navbar-item">Tags</a>
                <a href="/admin/collections" class="admin-navbar-item">Collections</a>
            </div>

            <div class="admin-navbar-end">
                <div class="admin-navbar-item">
                    <span>Welcome, <%= user.username %></span>
                </div>
                <div class="admin-navbar-item">
                    <a href="/" class="btn btn-ghost">View Site</a>
                </div>
                <div class="admin-navbar-item">
                    <form method="POST" action="/admin/logout" style="display: inline;">
                        <button type="submit" class="btn btn-ghost">Logout</button>
                    </form>
                </div>
            </div>
        </div>
    </nav>

    <main class="admin-main">
        <div class="admin-container">
            <div class="admin-header">
                <h1><%= character ? 'Edit' : 'Add' %> Upper Campus Character</h1>
                <div class="admin-header-actions">
                    <a href="/admin/upper-campus" class="btn btn-ghost">‚Üê Back to Upper Campus</a>
                </div>
            </div>

            <% if (error) { %>
                <div class="error-message">
                    <%= error %>
                </div>
            <% } %>

            <form class="admin-form upper-campus-form" method="POST" enctype="multipart/form-data" 
                  action="<%= character ? '/admin/upper-campus/' + character.id : '/admin/upper-campus' %>">
                
                <div class="form-grid">
                    <!-- Basic Information -->
                    <div class="form-section">
                        <h3>Basic Information</h3>
                        
                        <div class="admin-form-group">
                            <label class="admin-form-label" for="name">Character Name *</label>
                            <input 
                                type="text" 
                                id="name" 
                                name="name" 
                                class="admin-form-input" 
                                value="<%= character ? character.name : '' %>" 
                                required
                                placeholder="Enter character name"
                            >
                        </div>

                        <div class="admin-form-group">
                            <label class="admin-form-label" for="dormitory">Dormitory</label>
                            <select id="dormitory" name="dormitory" class="admin-form-select">
                                <option value="">Select Dormitory</option>
                                <option value="Chastelle Hall" <%= character && character.dormitory === 'Chastelle Hall' ? 'selected' : '' %>>Chastelle Hall (Leopard - Ivory White)</option>
                                <option value="Ophion Tower" <%= character && character.dormitory === 'Ophion Tower' ? 'selected' : '' %>>Ophion Tower (Python - Midnight Black)</option>
                                <option value="Pandora's Landing" <%= character && character.dormitory === "Pandora's Landing" ? 'selected' : '' %>>Pandora's Landing (Gazelle - Gold)</option>
                                <option value="Valence Court" <%= character && character.dormitory === 'Valence Court' ? 'selected' : '' %>>Valence Court (Panda - Sapphire Blue)</option>
                                <option value="Lux Remorae" <%= character && character.dormitory === 'Lux Remorae' ? 'selected' : '' %>>Lux Remorae (Lanternfish - Neon Aqua)</option>
                                <option value="Briarspire House" <%= character && character.dormitory === 'Briarspire House' ? 'selected' : '' %>>Briarspire House (Porcupine - Crimson)</option>
                                <option value="Lacuna Gate" <%= character && character.dormitory === 'Lacuna Gate' ? 'selected' : '' %>>Lacuna Gate (Pig - Violet)</option>
                                <option value="Fetterleigh Sanctum" <%= character && character.dormitory === 'Fetterleigh Sanctum' ? 'selected' : '' %>>Fetterleigh Sanctum (Axolotl - Jade Green)</option>
                                <option value="Verity's Pinnacle" <%= character && character.dormitory === "Verity's Pinnacle" ? 'selected' : '' %>>Verity's Pinnacle (Falcon - Steel Silver)</option>
                                <option value="Tessellate Keep" <%= character && character.dormitory === 'Tessellate Keep' ? 'selected' : '' %>>Tessellate Keep (Salamander - Cloud Grey)</option>
                            </select>
                        </div>

                        <div class="admin-form-group">
                            <label class="admin-form-label" for="grade">Grade</label>
                            <input 
                                type="text" 
                                id="grade" 
                                name="grade" 
                                class="admin-form-input" 
                                value="<%= character ? character.grade : '' %>" 
                                placeholder="e.g., 9th Grade, Sophomore, Year 3, etc."
                            >
                            <div class="form-hint">Academic grade or year level</div>
                        </div>

                        <div class="admin-form-group">
                            <label class="admin-form-label" for="age_category">Age Category</label>
                            <select id="age_category" name="age_category" class="admin-form-select">
                                <option value="">Select Age</option>
                                <option value="Toddler" <%= character && character.age_category === 'Toddler' ? 'selected' : '' %>>Toddler</option>
                                <option value="Kid" <%= character && character.age_category === 'Kid' ? 'selected' : '' %>>Kid</option>
                                <option value="Teen" <%= character && character.age_category === 'Teen' ? 'selected' : '' %>>Teen</option>
                                <option value="Adult" <%= character && character.age_category === 'Adult' ? 'selected' : '' %>>Adult</option>
                            </select>
                        </div>

                        <div class="admin-form-group">
                            <label class="admin-form-label" for="age">Age (Years)</label>
                            <input 
                                type="number" 
                                id="age" 
                                name="age" 
                                class="admin-form-input" 
                                value="<%= character ? character.age : '' %>" 
                                placeholder="Specific age in years"
                                min="0"
                                max="200"
                            >
                            <div class="form-hint">Specific age in years - useful for handling age discrepancies across different media</div>
                        </div>

                        <div class="form-grid">
                            <div class="admin-form-group">
                                <label class="admin-form-label" for="hair_color">Hair Color</label>
                                <input 
                                    type="text" 
                                    id="hair_color" 
                                    name="hair_color" 
                                    class="admin-form-input" 
                                    value="<%= character ? character.hair_color : '' %>" 
                                    placeholder="e.g., Brown, Blonde, etc."
                                >
                            </div>

                            <div class="admin-form-group">
                                <label class="admin-form-label" for="eye_color">Eye Color</label>
                                <input 
                                    type="text" 
                                    id="eye_color" 
                                    name="eye_color" 
                                    class="admin-form-input" 
                                    value="<%= character ? character.eye_color : '' %>" 
                                    placeholder="e.g., Blue, Green, etc."
                                >
                            </div>
                        </div>
                    </div>

                    <!-- Portrait Upload -->
                    <div class="form-section">
                        <h3>Character Portrait</h3>
                        
                        <div class="admin-form-group">
                            <label class="admin-form-label" for="portrait">Character Portrait</label>
                            <div class="admin-upload-area">
                                <input type="file" id="portrait" name="portrait" accept="image/*" style="display: none;">
                                <div class="upload-content">
                                    <div class="upload-icon">üì∑</div>
                                    <div class="upload-text">Click to upload portrait or drag and drop</div>
                                    <div class="upload-hint">Recommended: Square image, 256x256px or larger</div>
                                </div>
                            </div>
                            <% if (character && character.portrait_thumb_path) { %>
                                <div class="current-image">
                                    <img src="/uploads/<%= character.portrait_thumb_path %>" alt="Current portrait" style="max-width: 100px; border-radius: 8px; margin-top: 0.5rem;">
                                </div>
                            <% } %>
                        </div>
                    </div>
                </div>

                <!-- Extended Character Information -->
                <div class="form-section full-width">
                    <h3>Character Details</h3>
                    
                    <div class="form-grid extended-fields">
                        <div class="admin-form-group">
                            <label class="admin-form-label" for="aliases">Aliases</label>
                            <input 
                                type="text" 
                                id="aliases" 
                                name="aliases" 
                                class="admin-form-input" 
                                value="<%= character ? character.aliases : '' %>" 
                                placeholder="Comma-separated nicknames & alternate names"
                            >
                            <div class="form-hint">Example: Nicky, The Shadow, Moon Child</div>
                        </div>

                        <div class="admin-form-group">
                            <label class="admin-form-label" for="measurements">Measurements</label>
                            <input 
                                type="text" 
                                id="measurements" 
                                name="measurements" 
                                class="admin-form-input" 
                                value="<%= character ? character.measurements : '' %>" 
                                placeholder="Height, Weight, Bust-Waist-Hips"
                            >
                            <div class="form-hint">Example: 5'6", 130lbs, 34-24-36</div>
                        </div>

                        <div class="admin-form-group">
                            <label class="admin-form-label" for="birthday">Birthday</label>
                            <input 
                                type="text" 
                                id="birthday" 
                                name="birthday" 
                                class="admin-form-input" 
                                value="<%= character ? character.birthday : '' %>" 
                                placeholder="DD Month or MM/DD"
                            >
                            <div class="form-hint">Example: 15 March or 03/15</div>
                        </div>

                        <div class="admin-form-group">
                            <label class="admin-form-label" for="hair_attributes">Hair Attributes</label>
                            <input 
                                type="text" 
                                id="hair_attributes" 
                                name="hair_attributes" 
                                class="admin-form-input" 
                                value="<%= character ? character.hair_attributes : '' %>" 
                                placeholder="Comma-separated hair attributes"
                            >
                            <div class="form-hint">Example: Curly, Long, Braided, Highlights</div>
                        </div>

                        <div class="admin-form-group">
                            <label class="admin-form-label" for="eye_attributes">Eye Attributes</label>
                            <input 
                                type="text" 
                                id="eye_attributes" 
                                name="eye_attributes" 
                                class="admin-form-input" 
                                value="<%= character ? character.eye_attributes : '' %>" 
                                placeholder="Comma-separated eye attributes"
                            >
                            <div class="form-hint">Example: Bright, Heterochromia, Large, Mysterious</div>
                        </div>

                        <div class="admin-form-group">
                            <label class="admin-form-label" for="body_features">Body Features</label>
                            <input 
                                type="text" 
                                id="body_features" 
                                name="body_features" 
                                class="admin-form-input" 
                                value="<%= character ? character.body_features : '' %>" 
                                placeholder="Comma-separated body features"
                            >
                            <div class="form-hint">Example: Tall, Athletic, Scar on left arm, Freckles</div>
                        </div>

                        <div class="admin-form-group">
                            <label class="admin-form-label" for="clothing_accessories">Clothing & Accessories</label>
                            <input 
                                type="text" 
                                id="clothing_accessories" 
                                name="clothing_accessories" 
                                class="admin-form-input" 
                                value="<%= character ? character.clothing_accessories : '' %>" 
                                placeholder="Comma-separated clothing/accessory items"
                            >
                            <div class="form-hint">Example: Silver necklace, Black boots, School uniform, Reading glasses</div>
                        </div>

                        <div class="admin-form-group">
                            <label class="admin-form-label" for="personal_items">Personal Items</label>
                            <input 
                                type="text" 
                                id="personal_items" 
                                name="personal_items" 
                                class="admin-form-input" 
                                value="<%= character ? character.personal_items : '' %>" 
                                placeholder="Comma-separated personal items"
                            >
                            <div class="form-hint">Example: Ancient tome, Lucky charm, Family photo, Crystal pendant</div>
                        </div>

                        <div class="admin-form-group">
                            <label class="admin-form-label" for="personality_traits">Personality Traits</label>
                            <input 
                                type="text" 
                                id="personality_traits" 
                                name="personality_traits" 
                                class="admin-form-input" 
                                value="<%= character ? character.personality_traits : '' %>" 
                                placeholder="Comma-separated personality traits & quirks"
                            >
                            <div class="form-hint">Example: Curious, Shy, Determined, Loves cats, Afraid of heights</div>
                        </div>

                        <div class="admin-form-group">
                            <label class="admin-form-label" for="character_roles">Character Roles</label>
                            <input 
                                type="text" 
                                id="character_roles" 
                                name="character_roles" 
                                class="admin-form-input" 
                                value="<%= character ? character.character_roles : '' %>" 
                                placeholder="Comma-separated character roles & relationships"
                            >
                            <div class="form-hint">Example: Student, Best friend, Rival, Mentor</div>
                        </div>

                        <div class="admin-form-group">
                            <label class="admin-form-label" for="activities_hobbies">Activities & Hobbies</label>
                            <input 
                                type="text" 
                                id="activities_hobbies" 
                                name="activities_hobbies" 
                                class="admin-form-input" 
                                value="<%= character ? character.activities_hobbies : '' %>" 
                                placeholder="Comma-separated activities & hobbies"
                            >
                            <div class="form-hint">Example: Reading, Swimming, Magic practice, Cooking</div>
                        </div>

                        <div class="admin-form-group">
                            <label class="admin-form-label" for="story_events">Story Events/Experiences</label>
                            <input 
                                type="text" 
                                id="story_events" 
                                name="story_events" 
                                class="admin-form-input" 
                                value="<%= character ? character.story_events : '' %>" 
                                placeholder="Comma-separated story events/experiences"
                            >
                            <div class="form-hint">Example: Transfer student, Lost memory, Discovered magic, Saved the academy</div>
                        </div>

                        <div class="admin-form-group">
                            <label class="admin-form-label" for="sexual_activities">Sexual Activities</label>
                            <input 
                                type="text" 
                                id="sexual_activities" 
                                name="sexual_activities" 
                                class="admin-form-input" 
                                value="<%= character ? character.sexual_activities : '' %>" 
                                placeholder="Comma-separated sexual activities"
                            >
                            <div class="form-hint">Example: Kissing, Cuddling, BDSM, Vanilla</div>
                        </div>

                        <div class="admin-form-group">
                            <label class="admin-form-label" for="sexual_themes">Sexual Themes/Experiences</label>
                            <input 
                                type="text" 
                                id="sexual_themes" 
                                name="sexual_themes" 
                                class="admin-form-input" 
                                value="<%= character ? character.sexual_themes : '' %>" 
                                placeholder="Comma-separated sexual themes/experiences"
                            >
                            <div class="form-hint">Example: Romance, First love, Experimentation, Forbidden relationship</div>
                        </div>
                    </div>
                </div>

                <!-- Description -->
                <div class="form-section full-width">
                    <h3>Description</h3>
                    
                    <div class="admin-form-group">
                        <label class="admin-form-label" for="description">Character Description</label>
                        <textarea 
                            id="description" 
                            name="description" 
                            class="admin-form-textarea" 
                            rows="6"
                            placeholder="Character background, personality, biography, etc."
                        ><%= character ? character.description : '' %></textarea>
                    </div>
                </div>

                <div class="form-actions">
                    <button type="submit" class="btn btn-solid">
                        <%= character ? 'Update' : 'Create' %> Character
                    </button>
                    <a href="/admin/upper-campus" class="btn btn-ghost">Cancel</a>
                </div>
            </form>
        </div>
    </main>

    <style>
    .upper-campus-form .form-grid {
        display: grid;
        grid-template-columns: 1fr 1fr;
        gap: 2rem;
        margin-bottom: 2rem;
    }

    .form-section.full-width {
        grid-column: 1 / -1;
        margin-bottom: 2rem;
    }

    .extended-fields {
        grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
        gap: 1rem;
    }

    .form-hint {
        font-size: 0.8rem;
        color: var(--text-secondary);
        margin-top: 0.25rem;
        font-style: italic;
    }

    .form-actions {
        display: flex;
        gap: 1rem;
        margin-top: 2rem;
        padding-top: 1rem;
        border-top: 1px solid var(--border);
    }

    .upload-content {
        text-align: center;
        padding: 1rem;
    }

    .upload-icon {
        font-size: 2rem;
        margin-bottom: 0.5rem;
    }

    .upload-text {
        font-weight: 500;
        margin-bottom: 0.25rem;
    }

    .upload-hint {
        font-size: 0.85rem;
        color: var(--text-secondary);
    }

    .current-image {
        margin-top: 1rem;
        text-align: center;
    }

    .error-message {
        background: var(--error);
        color: white;
        padding: 1rem;
        border-radius: 6px;
        margin-bottom: 1.5rem;
    }

    @media (max-width: 768px) {
        .upper-campus-form .form-grid {
            grid-template-columns: 1fr;
        }
        
        .extended-fields {
            grid-template-columns: 1fr;
        }
        
        .form-actions {
            flex-direction: column;
        }
    }
    </style>

    <script src="/public/js/app.js"></script>
    <script src="/public/js/admin.js"></script>
    <script>
    // Upload area functionality
    document.addEventListener('DOMContentLoaded', function() {
        const uploadArea = document.querySelector('.admin-upload-area');
        const fileInput = document.getElementById('portrait');
        
        if (uploadArea && fileInput) {
            uploadArea.addEventListener('click', () => fileInput.click());
            
            uploadArea.addEventListener('dragover', (e) => {
                e.preventDefault();
                uploadArea.style.backgroundColor = 'var(--primary-dark)';
            });
            
            uploadArea.addEventListener('dragleave', () => {
                uploadArea.style.backgroundColor = '';
            });
            
            uploadArea.addEventListener('drop', (e) => {
                e.preventDefault();
                uploadArea.style.backgroundColor = '';
                
                const files = e.dataTransfer.files;
                if (files.length > 0) {
                    fileInput.files = files;
                }
            });
        }
    });
    </script>
</body>
</html>