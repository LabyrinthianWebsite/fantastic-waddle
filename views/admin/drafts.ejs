<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Drafts - Admin - CommissionDB</title>
    <link rel="stylesheet" href="/public/css/style.css">
    <link rel="stylesheet" href="/public/css/admin.css">
</head>
<body class="dark-theme">
    <nav class="admin-navbar">
        <div class="admin-navbar-container">
            <div class="admin-navbar-brand">
                <a href="/admin">CommissionDB Admin</a>
            </div>
            
            <div class="admin-navbar-menu">
                <a href="/admin" class="admin-navbar-item">Dashboard</a>
                <a href="/admin/commissions" class="admin-navbar-item">Commissions</a>
                <a href="/admin/drafts" class="admin-navbar-item active">Drafts</a>
                <a href="/admin/characters" class="admin-navbar-item">Characters</a>
                <a href="/admin/upper-campus" class="admin-navbar-item">Upper Campus</a>
                <a href="/admin/artists" class="admin-navbar-item">Artists</a>
                <a href="/admin/collections" class="admin-navbar-item">Collections</a>
                <a href="/admin/tags" class="admin-navbar-item">Tags</a>
                <form action="/admin/logout" method="POST" style="display: inline;">
                    <button type="submit" class="admin-navbar-item admin-logout">Logout</button>
                </form>
            </div>
        </div>
    </nav>

    <main class="admin-main">
        <div class="admin-container">
            <div class="admin-header">
                <h1>Drafts</h1>
                <a href="/admin/drafts/new" class="btn btn-solid">Add New Draft</a>
            </div>

            <div class="admin-content">
                <% if (drafts.length === 0) { %>
                    <div class="empty-state">
                        <h3>No Drafts Yet</h3>
                        <p>Drafts are works in progress that you can track through different stages before converting to full commissions.</p>
                        <a href="/admin/drafts/new" class="btn btn-solid">Add Your First Draft</a>
                    </div>
                <% } else { %>
                    <div class="admin-grid">
                        <% drafts.forEach(draft => { %>
                            <div class="admin-card draft-card">
                                <div class="draft-info">
                                    <h3><%= draft.title %></h3>
                                    
                                    <div class="draft-meta">
                                        <span class="status-badge status-<%= draft.status %>">
                                            <%= draft.status.charAt(0).toUpperCase() + draft.status.slice(1).replace('_', ' ') %>
                                        </span>
                                        <% if (draft.artist_name) { %>
                                            <span class="artist-badge">
                                                <%= draft.artist_name %>
                                            </span>
                                        <% } %>
                                        <% if (draft.client_name) { %>
                                            <span class="client-badge">Client: <%= draft.client_name %></span>
                                        <% } %>
                                        <% if (draft.price) { %>
                                            <span class="price-badge">$<%= draft.price %></span>
                                        <% } %>
                                        <% if (draft.deadline_date) { %>
                                            <span class="deadline-badge">Due: <%= draft.deadline_date %></span>
                                        <% } %>
                                    </div>
                                    <% if (draft.description) { %>
                                        <p class="draft-description">
                                            <%= draft.description.substring(0, 150) %><% if (draft.description.length > 150) { %>...<% } %>
                                        </p>
                                    <% } %>
                                    <% if (draft.notes) { %>
                                        <p class="draft-notes">
                                            <strong>Notes:</strong> <%= draft.notes.substring(0, 100) %><% if (draft.notes.length > 100) { %>...<% } %>
                                        </p>
                                    <% } %>
                                </div>
                                
                                <div class="draft-actions">
                                    <a href="/admin/drafts/<%= draft.id %>/edit" class="btn btn-solid">Edit</a>
                                    <% if (draft.status === 'completed' || draft.status === 'delivered') { %>
                                        <button onclick="convertToCommission(<%= draft.id %>)" class="btn btn-success">Convert to Commission</button>
                                    <% } %>
                                    <form method="POST" action="/admin/drafts/<%= draft.id %>/delete" style="display: inline;" 
                                          onsubmit="return confirm('Are you sure you want to delete this draft? This action cannot be undone and will delete all associated files.')">
                                        <button type="submit" class="btn btn-danger btn-sm">Delete</button>
                                    </form>
                                </div>
                            </div>
                        <% }); %>
                    </div>
                <% } %>
            </div>
        </div>
    </main>

    <style>
    .draft-card {
        display: flex;
        flex-direction: column;
        gap: 1rem;
        padding: 1.5rem;
    }

    .draft-info h3 {
        margin-bottom: 0.5rem;
        color: var(--text-primary);
    }

    .draft-meta {
        display: flex;
        flex-wrap: wrap;
        gap: 0.5rem;
        margin-bottom: 1rem;
    }

    .status-badge {
        padding: 0.25rem 0.5rem;
        border-radius: 0.25rem;
        font-size: 0.75rem;
        font-weight: 600;
        text-transform: uppercase;
    }

    .status-requested { background-color: #64748b; color: white; }
    .status-accepted { background-color: #0ea5e9; color: white; }
    .status-in-progress { background-color: #f59e0b; color: white; }
    .status-completed { background-color: #10b981; color: white; }
    .status-delivered { background-color: #8b5cf6; color: white; }
    .status-canceled { background-color: #ef4444; color: white; }

    .artist-badge, .client-badge, .price-badge, .deadline-badge {
        padding: 0.25rem 0.5rem;
        border-radius: 0.25rem;
        font-size: 0.75rem;
        background-color: var(--surface-secondary);
        color: var(--text-secondary);
    }

    .draft-description, .draft-notes {
        margin-bottom: 0.5rem;
        color: var(--text-secondary);
        font-size: 0.875rem;
    }

    .draft-notes {
        font-style: italic;
    }

    .draft-actions {
        display: flex;
        gap: 0.5rem;
        flex-wrap: wrap;
        margin-top: auto;
    }

    .btn-success {
        background-color: #10b981;
        color: white;
        border: none;
        padding: 0.5rem 1rem;
        border-radius: 0.25rem;
        cursor: pointer;
        font-size: 0.875rem;
        transition: background-color 0.2s;
    }

    .btn-success:hover {
        background-color: #059669;
    }

    .empty-state {
        text-align: center;
        padding: 4rem 2rem;
        color: var(--text-secondary);
    }

    .empty-state h3 {
        margin-bottom: 1rem;
        color: var(--text-primary);
    }

    .empty-state p {
        margin-bottom: 2rem;
    }
    </style>

    <script>
    async function convertToCommission(draftId) {
        if (!confirm('Convert this draft to a commission? This will move all images and data to a new commission and delete the draft.')) {
            return;
        }

        try {
            const response = await fetch(`/admin/drafts/${draftId}/convert`, {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json'
                }
            });

            const result = await response.json();

            if (result.success) {
                alert('Draft successfully converted to commission!');
                window.location.href = `/admin/commissions/${result.commissionId}/edit`;
            } else {
                alert('Error: ' + result.error);
            }
        } catch (error) {
            alert('Error converting draft: ' + error.message);
        }
    }
    </script>

    <script src="/public/js/app.js"></script>
    <script src="/public/js/admin.js"></script>
</body>
</html>